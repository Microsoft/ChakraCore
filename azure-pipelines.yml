trigger:
- master
- release/*

jobs:
  - job: Linux
    timeoutInMinutes: 0
    pool:
      vmImage: 'ubuntu-latest'
    strategy:
      matrix:
        debug:
          build_type: 'Debug'
          test_target: 'check'
        release_with_debug:
          build_type: 'RelWithDebInfo'
          test_target: 'check'
        release:
          build_type: 'Release'
          test_target: 'all'

    steps:
    - script: sudo apt-get install -y ninja-build clang libicu-dev
      displayName: 'Install dependencies'
  
    - script: |
        mkdir -p build
      displayName: 'Create build directories'

    - script: |
        cd build
        cmake -GNinja -DCMAKE_BUILD_TYPE=$BUILD_TYPE -DCMAKE_CXX_COMPILER=clang++ -DCMAKE_C_COMPILER=clang ..
      displayName: CMake
      env:
        BUILD_TYPE: $(build_type)

    - script: |
        cd build
        ninja $TARGET
      displayName: 'Build and test'
      env:
        TARGET: $(test_target)
