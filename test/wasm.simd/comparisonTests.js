//-------------------------------------------------------------------------------------------------------
// Copyright (C) Microsoft Corporation and contributors. All rights reserved.
// Licensed under the MIT license. See LICENSE.txt file in the project root for full license information.
//-------------------------------------------------------------------------------------------------------
let passed = true;
function check(expected, funName, args)
{
  let fun = eval(funName);
  let result;
  try {
     result = fun(...args);
  } catch (e) {
    result = e.message;
  }

  if(result != expected) {
    passed = false;
    print(`${funName}(${[...args]}) produced ${result}, expected ${expected}`);
  }
}

let ffi = {};
var mod, exports;

mod = new WebAssembly.Module(readbuffer('comp.wasm'));
exports = new WebAssembly.Instance(mod, ffi).exports;

tests = [

    //i32x4
    {
        func: "func_i32x4_compare_s",
        args: [2147483647, 0, -100, -2147483648,
               2147483647, 45, 202 , -2147483648,
               0], //eq
        expected: 9 //1001
    },

    {
        func: "func_i32x4_compare_s",
        args: [277, 2147483647, -100, 2147483647,
               431, 2147483647, 555 , 2147483647,
               0], //eq
        expected: 5 //0101
    },

    {
        func: "func_i32x4_compare_s",
        args: [2147483647, 0, -100, -2147483648,
               2147483647, 45, 202 , -2147483648,
               1], //ne
        expected: 6 //0110
    },

    {
        func: "func_i32x4_compare_s",
        args: [277, 2147483647, -100, 2147483647,
               431, 2147483647, 555 , 2147483647,
               1], //ne
        expected: 10 //1010
    },

    {
        func: "func_i32x4_compare_s",
        args: [-1, 1440, 2100, -2147483648,
               2147483647, 45, 202 , 4,
               2], //lt
        expected: 9 //1001
    },

    {
        func: "func_i32x4_compare_s",
        args: [431, -2147483646, 555, 21474836,
               277, 2147483647, -100 , 2147483647,
               2], //lt
        expected: 5 //0101
    },

    {
        func: "func_i32x4_compare_s",
        args: [2147483647, 1440, 2100, 4,
               2147483647, 45, 202 , 4,
               3], //le
        expected: 9 //1001
    },

    {
        func: "func_i32x4_compare_s",
        args: [431, -2147483646, 555, 21474835,
               277,  -2147483646, -100 , 21474836,
               3], //le
        expected: 5 //0101
    },

    {
        func: "func_i32x4_compare_s",
        args: [-1, 1440, 2100, -2147483648,
               2147483647, 45, 202 , 4,
              4], //gt
        expected: 6 //0110
    },

    {
        func: "func_i32x4_compare_s",
        args: [431, -2147483646, 555, 21474836,
               277, 2147483647, -100 , 2147483647,
               4], //gt
        expected: 10 //1010
    },

    {
        func: "func_i32x4_compare_s",
        args: [-1, 1440, 2100, -2147483648,
               2147483647, 1440, 202 , 4,
               5], //ge
        expected: 6 //0110
    },

    {
        func: "func_i32x4_compare_s",
        args: [431, -2147483646, -100, 21474836,
               277, 2147483647, -100 , 2147483647,
               5], //ge
        expected: 10 //1010
    },

    //u32x4
    {
        func: "func_i32x4_compare_u",
        args: [2147483647, 0, -100, -2147483648,
               2147483647, 45, 202 , -2147483648,
               0], //eq
        expected: 9 //1001
    },

    {
        func: "func_i32x4_compare_u",
        args: [277, 2147483647, -100, 2147483647,
               431, 2147483647, 555 , 2147483647,
               0], //eq
        expected: 5 //0101
    },

    {
        func: "func_i32x4_compare_u",
        args: [2147483647, 0, -100, -2147483648,
               2147483647, 45, 202 , -2147483648,
               1], //ne
        expected: 6 //0110
    },

    {
        func: "func_i32x4_compare_u",
        args: [277, 2147483647, -100, 2147483647,
               431, 2147483647, 555 , 2147483647,
              1], //ne
        expected: 10 //1010
    },

    {
        func: "func_i32x4_compare_u",
        args: [-100, 1440, 2100, -2147483648,
               -1, 45, 202 , -2147483647,
              2], //lt
        expected: 9 //1001
    },

    {
        func: "func_i32x4_compare_u",
        args: [431, 2147483646, 555, 21474836,
               277, -2147483647, 100 , 2147483647,
              2], //lt
        expected: 5 //0101
    },

    {
        func: "func_i32x4_compare_u",
        args: [2147483647, 1440, 2100, 4,
               2147483647, 45, 202 , 4,
              3], //le
        expected: 9 //1001
    },

    {
        func: "func_i32x4_compare_u",
        args: [431, -2147483646, -555, 21474835,
               277,  -2147483646, 100 , 21474836,
              3], //le
        expected: 5 //0101
    },

    {
        func: "func_i32x4_compare_u",
        args: [ 2147483647, 1440, 2100, 2147483647,
                -1, 45, 202 , -4,
              4], //gt
        expected: 6 //0110
    },

    {
        func: "func_i32x4_compare_u",
        args: [431, 2147483646, 555, 21474836,
               277, -2147483647, 100 , 2147483647,
              4], //gt
        expected: 10 //1010
    },

    {
        func: "func_i32x4_compare_u",
        args: [1, 1440, 2100, 2147483648,
               -2147483647, 1440, 202 , -4,
              5], //ge
        expected: 6 //0110
    },

    {
        func: "func_i32x4_compare_u",
        args: [431, 2147483646, -100, 21474836,
               277, -2147483647, -100 , 2147483647,
              5], //ge
        expected: 10 //1010
    },

    //i16x8
    {
        func: "func_i16x8_compare_s",
        args: [65535, 0, -100, -777, 4, 2, 207 , -65536,
               65535, 0, -123, -777, 3, 1, 202 , -65536,
               0], //eq
        expected: 209 //11010001
    },

    {
        func: "func_i16x8_compare_s",
        args: [11, 2147483647, -200, 2147483647, 431, 2147483647, 555 , 2147483647,
               277, 2147483647, -100, 2147483647, 432, 2147483647, 755 , 2147483647,
               0], //eq
        expected: 85 //01010101
    },

    {
        func: "func_i16x8_compare_s",
        args: [65535, 0, -100, -777, 4, 2, 207 , -65536,
               65535, 0, -123, -777, 3, 1, 202 , -65536,
               1], //ne
        expected: 46 //00101110
    },

    {
        func: "func_i16x8_compare_s",
        args: [11, 2147483647, -200, 2147483647, 431, 2147483647, 555 , 2147483647,
               277, 2147483647, -100, 2147483647, 432, 2147483647, 755 , 2147483647,
               1], //ne
        expected: 170 //10101010
    },

    {
        func: "func_i16x8_compare_s",
        args: [32766, -1, -100, -778, 4, 2, 207 , -32768,
               32767, 0, -123, -777, 3, 1, 202 , -32767,
               2], //lt
        expected: 209 //11010001
    },

    {
        func: "func_i16x8_compare_s",
        args: [1111, 32766, -99, 32765, 1001, 1, 855 , -32768,
               277, 32767, -100, 32766, 432, 2, 755 , -32767,
               2], //lt
        expected: 85 //01010101
    },

    {
        func: "func_i16x8_compare_s",
        args: [32767, -1, -100, -778, 4, 2, 207 , -32768,
               32767, -1, -123, -777, 3, 1, 202 , -32767,
               3], //le
        expected: 209 //11010001
    },

    {
        func: "func_i16x8_compare_s",
        args: [1111, 32766, -99, 32765, 1001, 1, 855 , -32768,
               277, 32767, -100, 32766, 432, 2, 855 , -32767,
               3], //le
        expected: 87 //01010111
    },

    {
        func: "func_i16x8_compare_s",
        args: [32766, -1, -100, -778, 4, 2, 207 , -32768,
               32767, 0, -123, -777, 3, 1, 202 , -32767,
               4], //gt
        expected: 46 //00101110
    },

    {
        func: "func_i16x8_compare_s",
        args: [1111, 32766, -99, 32765, 1001, 1, 855 , -32768,
               277, 32767, -100, 32766, 432, 2, 755 , -32767,
               4], //gt
        expected: 170 //10101010
    },

    {
        func: "func_i16x8_compare_s",
        args: [32767, -1, -100, -778, 4, 2, 207 , -32768,
               32767, -1, -123, -777, 3, 1, 202 , -32767,
               5], //ge
        expected: 238 //11101110
    },

    {
        func: "func_i16x8_compare_s",
        args: [1111, 32766, -99, 32765, 1001, 1, 855 , -32768,
               277, 32767, -100, 32766, 432, 2, 855 , -32767,
               5], //ge
        expected: 170 //10101010
    },

     //u16x8
    {
        func: "func_i16x8_compare_u",
        args: [65534, 32766, 129, 0, 4, 2, 207 , 65530,
               65535, 32767, 123, 1, 3, 1, 202 , 65531,
               2], //lt
        expected: 209 //11010001
    },

    {
        func: "func_i16x8_compare_u",
        args: [1111, 32766, 65535, 32765, 1001, 1, 855 , 32767,
               277, 32767, 65531, 32766, 432, 2, 755 , 32768,
               2], //lt
        expected: 85 //01010101
    },

    {
        func: "func_i16x8_compare_u",
        args: [65535, 32766, 129, 0, 4, 2, 207 , 65530,
               65535, 32767, 123, 1, 3, 1, 202 , 65531,
               3], //le
        expected: 209 //11010001
    },

    {
        func: "func_i16x8_compare_u",
        args: [1111, 32766, 65535, 32765, 1001, 1, 855 , 32767,
               277, 32767, 65531, 32766, 432, 2, 855 , 32768,
               3], //le
        expected: 87 //01010111
    },

    {
        func: "func_i16x8_compare_u",
        args: [65534, 32766, 129, 0, 4, 2, 207 , 65530,
               65535, 32767, 123, 1, 3, 1, 202 , 65531,
               4], //gt
        expected: 46 //00101110
    },

    {
        func: "func_i16x8_compare_u",
        args: [1111, 32766, 65535, 32765, 1001, 1, 855 , 32767,
               277, 32767, 65531, 32766, 432, 2, 755 , 32768,
               4], //gt
        expected: 170 //10101010
    },

    {
        func: "func_i16x8_compare_u",
        args: [65535, 32767, 129, 0, 4, 2, 207 , 65530,
               65535, 32766, 123, 1, 3, 1, 202 , 65531,
               5], //ge
        expected: 238 //11101110
    },

    {
        func: "func_i16x8_compare_u",
        args: [1111, 32766, 65535, 32765, 1001, 1, 855 , 32767,
               277, 32767, 65531, 32766, 432, 2, 855 , 32768,
               5], //ge
        expected: 170 //10101010
    },

    //i8x16
    {
        func: "func_i16x8_compare_s",
        args: [255, 0, -100, -77, 4, 2, 207 , -1,
               255, 0, -123, -77, 3, 1, 202 , -1,
               0], //eq
        expected: 209 //11010001
    },

    {
        func: "func_i16x8_compare_s",
        args: [11, 127, -111, 127, 43, 127, 55 , 127,
               12, 127, -100, 127, 42, 127, 75 , 127,
               0], //eq
        expected: 85 //01010101
    },

    {
        func: "func_i16x8_compare_s",
        args: [255, 0, -100, -77, 4, 2, 207 , -1,
               255, 0, -123, -77, 3, 1, 202 , -1,
               1], //ne
        expected: 46 //00101110
    },

    {
        func: "func_i16x8_compare_s",
        args: [11, 127, -111, 127, 431, 127, 555 , 127,
               12, 127, -100, 127, 432, 127, 755 , 127,
               1], //ne
        expected: 170 //10101010
    },

    {
        func: "func_i16x8_compare_s",
        args: [126, -1, -100, -78, 4, 2, 27 , -128,
               127, 0, -123, -77, 3, 1, 22 , -127,
               2], //lt
        expected: 209 //11010001
    },

    {
        func: "func_i16x8_compare_s",
        args: [111, 126, -99, 64, 101, 1, 85 , -128,
               12, 127, -100, 126, 43, 2, 75 , -127,
               2], //lt
        expected: 85 //01010101
    },

    {
        func: "func_i16x8_compare_s",
        args: [127, -1, -100, -78, 4, 2, 27 , -128,
               127, -1, -123, -77, 3, 1, 22 , -127,
               3], //le
        expected: 209 //11010001
    },

    {
        func: "func_i16x8_compare_s",
        args: [111, 126, -99, 64, 101, 1, 85 , -128,
               12, 127, -100, 126, 43, 2, 85 , -127,
               3], //le
        expected: 87 //01010111
    },

    {
        func: "func_i16x8_compare_s",
        args: [126, -1, -100, -78, 4, 2, 27 , -128,
               127, 0, -123, -77, 3, 1, 22 , -127,
               4], //gt
        expected: 46 //00101110
    },

    {
        func: "func_i16x8_compare_s",
        args: [111, 126, -99, 64, 101, 1, 85 , -128,
               12, 127, -100, 126, 43, 2, 75 , -127,
               4], //gt
        expected: 170 //10101010
    },

    {
        func: "func_i16x8_compare_s",
        args: [127, -1, -100, -78, 4, 2, 27 , -128,
               127, -1, -123, -77, 3, 1, 22 , -127,
               5], //ge
        expected: 238 //11101110
    },

    {
        func: "func_i16x8_compare_s",
        args: [111, 126, -99, 64, 101, 1, 85 , -128,
               12, 127, -100, 126, 42, 2, 85 , -127,
               5], //ge
        expected: 170 //10101010
    },

    //u8x16
    {
        func: "func_i16x8_compare_u",
        args: [253, 126, 129, 0, 4, 2, 207 , 63,
               255, 127, 123, 1, 3, 1, 202 , 65,
               2], //lt
        expected: 209 //11010001
    },

    {
        func: "func_i16x8_compare_u",
        args: [111, 126, 255, 64, 101, 1, 85 , 127,
               12, 127, 65, 126, 43, 2, 75 , 128,
               2], //lt
        expected: 85 //01010101
    },

    {
        func: "func_i16x8_compare_u",
        args: [255, 126, 129, 0, 4, 2, 207 , 63,
               255, 127, 123, 1, 3, 1, 202 , 65,
               3], //le
        expected: 209 //11010001
    },

    {
        func: "func_i16x8_compare_u",
        args: [111, 126, 255, 64, 101, 1, 85 , 127,
               12, 127, 65, 126, 43, 2, 85 , 128,
               3], //le
        expected: 87 //01010111
    },

    {
        func: "func_i16x8_compare_u",
        args: [253, 126, 129, 0, 4, 2, 207 , 63,
               255, 127, 123, 1, 3, 1, 202 , 65,
               4], //gt
        expected: 46 //00101110
    },

    {
        func: "func_i16x8_compare_u",
        args: [111, 126, 255, 64, 101, 1, 85 , 127,
               12, 127, 200, 126, 43, 2, 75 , 128,
               4], //gt
        expected: 170 //10101010
    },

    {
        func: "func_i16x8_compare_u",
        args: [255, 127, 129, 0, 4, 2, 207 , 63,
               255, 126, 123, 1, 3, 1, 202 , 65,
               5], //ge
        expected: 238 //11101110
    },

    {
        func: "func_i16x8_compare_u",
        args: [111, 126, 255, 64, 101, 1, 85 , 127,
               12, 127, 200, 126, 43, 2, 85 , 128,
               5], //ge
        expected: 170 //10101010
    },

    //f32x4
    {
        func: "func_f32x4_compare",
        args: [1234.5, 0, Number.NaN, -567.25,
               1234.5, 45, 202 , -567.25,
               0], //eq
        expected: 9 //1001
    },

    {
        func: "func_f32x4_compare",
        args: [277, 1234.5, -100, 1234.5,
               431, 1234.5, Number.NaN , 1234.5,
               0], //eq
        expected: 5 //0101
    },

    {
        func: "func_f32x4_compare",
        args: [1234.5, 0, -100, -567.25,
               1234.5, 45, Number.NaN , -567.25,
               1], //ne
        expected: 6 //0110
    },

    {
        func: "func_f32x4_compare",
        args: [277, 1234.5, -100, 1234.5,
               431, 1234.5, Number.NaN , 1234.5,
               1], //ne
        expected: 10 //1010
    },

    {
        func: "func_f32x4_compare",
        args: [-1, 1440, 2100, -567.25,
               1234.5, 45, 202 , 4,
               2], //lt
        expected: 9 //1001
    },

    {
        func: "func_f32x4_compare",
        args: [431, -2147483646, 555, 1234.1,
               277, 1234.5, -100 , 1234.5,
               2], //lt
        expected: 5 //0101
    },

    {
        func: "func_f32x4_compare",
        args: [1234.5, 1440, 2100, 4,
               1234.5, 45, 202 , 4,
               3], //le
        expected: 9 //1001
    },

    {
        func: "func_f32x4_compare",
        args: [431, -2147483646, 555, 21474835,
               277,  -2147483646, -100 , 21474836,
               3], //le
        expected: 5 //0101
    },

    {
        func: "func_f32x4_compare",
        args: [-1, 1440, 2100, -567.25,
               1234.5, 45, 202 , 4,
              4], //gt
        expected: 6 //0110
    },

    {
        func: "func_f32x4_compare",
        args: [431, -2147483646, 555, 1234.4,
               277, 1234.5, -100 , 1234.5,
               4], //gt
        expected: 10 //1010
    },

    {
        func: "func_f32x4_compare",
        args: [-1, 1440, 2100, -567.25,
               1234.5, 1440, 202 , 4,
               5], //ge
        expected: 6 //0110
    },

    {
        func: "func_f32x4_compare",
        args: [431, -2147483646, -100, 1234.4,
               277, 1234.5, -100 , 1234.5,
               5], //ge
        expected: 10 //1010
    },

];

for (let t of tests) {
    check(t.expected, "exports." + t.func, t.args);
}

if (passed) {
    print("Passed");
}
